# EasySight æ™ºèƒ½å®‰é˜²å¹³å° - å®Œæ•´é¡¹ç›®è¯´æ˜ä¹¦

## ğŸ“– é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç®€ä»‹
EasySight æ˜¯ä¸€ä¸ªé€šç”¨çš„åˆ†å¸ƒå¼æ™ºèƒ½å®‰é˜²å¹³å°ï¼Œè‡´åŠ›äºæä¾›å•†ä¸šé¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰åŸºç¡€èƒ½åŠ›ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¼€å‘è€…å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡ç®—æ³•çš„å¼€å‘ï¼Œä»è€Œå¿«é€Ÿå®ç°è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå‡å°‘é‡å¤é€ è½®å­çš„æ—¶é—´ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œè¿›ä¸€æ­¥æ¨åŠ¨AIæŠ€æœ¯çš„åº”ç”¨å’Œå‘å±•ã€‚

### é¡¹ç›®ç‰¹è‰²
- **é€šç”¨æ€§å¼º**: æä¾›å®Œæ•´çš„æ™ºèƒ½å®‰é˜²åŸºç¡€è®¾æ–½
- **åˆ†å¸ƒå¼æ¶æ„**: æ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²å’Œè´Ÿè½½å‡è¡¡
- **ç®—æ³•å¯æ‰©å±•**: æ”¯æŒåŠ¨æ€åŠ è½½å’Œç®¡ç†AIç®—æ³•åŒ…
- **å®¹å™¨åŒ–éƒ¨ç½²**: åŸºäºDockerçš„å¾®æœåŠ¡æ¶æ„
- **ç°ä»£åŒ–UI**: ç®€æ´ä¼˜é›…çš„ç”¨æˆ·ç•Œé¢è®¾è®¡

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Vue 3.3.8
- **UIç»„ä»¶åº“**: Element Plus 2.4.2
- **æ„å»ºå·¥å…·**: Vite 4.5.0
- **åŒ…ç®¡ç†**: Yarn
- **å¼€å‘è¯­è¨€**: TypeScript 5.2.0
- **çŠ¶æ€ç®¡ç†**: Pinia 2.1.7
- **è·¯ç”±**: Vue Router 4.2.5
- **å›¾è¡¨**: ECharts 5.6.0
- **è§†é¢‘æ’­æ”¾**: Video.js 8.6.1

### åç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: FastAPI 0.104.1
- **ASGIæœåŠ¡å™¨**: Uvicorn 0.24.0
- **å¼€å‘è¯­è¨€**: Python 3.8+
- **æ•°æ®åº“**: PostgreSQL 15
- **ç¼“å­˜**: Redis 7.2.5
- **å¯¹è±¡å­˜å‚¨**: MinIO
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQ
- **ORM**: SQLAlchemy 2.0.23
- **æ•°æ®åº“è¿ç§»**: Alembic 1.12.1
- **å›¾åƒå¤„ç†**: OpenCV 4.8.1.78, Pillow 10.1.0
- **è®¤è¯**: JWT (python-jose)

### æµåª’ä½“æœåŠ¡
- **åª’ä½“æœåŠ¡å™¨**: ZLMediaKit
- **åè®®æ”¯æŒ**: RTSP, RTMP, WebRTC, SRT
- **APIç«¯å£**: 18080 (æµåª’ä½“æœåŠ¡), 8060 (ZLMediaKit)
- **æµåª’ä½“ç«¯å£**: 554 (RTSP), 1935 (RTMP), 10000 (RTP)

### éƒ¨ç½²æ¶æ„
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **å¾®æœåŠ¡**: å‰åç«¯åˆ†ç¦» + æµåª’ä½“æœåŠ¡
- **æ•°æ®æŒä¹…åŒ–**: PostgreSQL + MinIO + Redis
- **è´Ÿè½½å‡è¡¡**: æ”¯æŒå¤šWorkerèŠ‚ç‚¹åˆ†å¸ƒå¼éƒ¨ç½²

## âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
- **å¤šç§Ÿæˆ·æ”¯æŒ**: æ”¯æŒå¤šç§Ÿæˆ·æ¶æ„
- **è§’è‰²æƒé™**: åŸºäºRBACçš„æƒé™ç®¡ç†
- **ç”¨æˆ·è®¤è¯**: JWTä»¤ç‰Œè®¤è¯æœºåˆ¶
- **ä¼šè¯ç®¡ç†**: æ”¯æŒä»¤ç‰Œåˆ·æ–°å’Œè¿‡æœŸç®¡ç†

### 2. æ‘„åƒå¤´ç®¡ç†
- **è®¾å¤‡ç®¡ç†**: æ‘„åƒå¤´çš„å¢åˆ æ”¹æŸ¥
- **å®æ—¶ç›‘æ§**: å¤šå±æ’­æ”¾æ”¯æŒ1/4/9/16åˆ†å±
- **æµåª’ä½“ä»£ç†**: æ”¯æŒå¤šç§æµåª’ä½“åè®®
- **è®¾å¤‡çŠ¶æ€ç›‘æ§**: å®æ—¶ç›‘æ§æ‘„åƒå¤´åœ¨çº¿çŠ¶æ€

### 3. AIåº”ç”¨ä¸­å¿ƒ
- **ç®—æ³•å¸‚åœº**: ä¸Šä¼ å’Œç®¡ç†AIç®—æ³•åŒ…
- **åŠ¨æ€åŠ è½½**: æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ç®—æ³•
- **ç‰ˆæœ¬ç®¡ç†**: æ”¯æŒå¤šç‰ˆæœ¬ç®—æ³•å¹¶å­˜
- **é…ç½®ç®¡ç†**: çµæ´»çš„ç®—æ³•å‚æ•°é…ç½®
- **åˆ†å¸ƒå¼æ‰§è¡Œ**: æ”¯æŒå¤šWorkerèŠ‚ç‚¹åˆ†å¸ƒå¼å¤„ç†

### 4. æ™ºèƒ½è¯Šæ–­ç³»ç»Ÿ
- **14ç§è¯Šæ–­ç®—æ³•**: è¦†ç›–å¸¸è§çš„è§†é¢‘è´¨é‡é—®é¢˜
  - äº®åº¦æ£€æµ‹ (BRIGHTNESS)
  - æ¸…æ™°åº¦æ£€æµ‹ (CLARITY)
  - å¯¹æ¯”åº¦æ£€æµ‹ (CONTRAST)
  - å™ªå£°æ£€æµ‹ (NOISE)
  - è“å±æ£€æµ‹ (BLUE_SCREEN)
  - å†»ç»“æ£€æµ‹ (FREEZE)
  - æŠ–åŠ¨æ£€æµ‹ (JITTER)
  - åè‰²æ£€æµ‹ (COLOR_CAST)
  - é®æŒ¡æ£€æµ‹ (OCCLUSION)
  - é©¬èµ›å…‹æ£€æµ‹ (MOSAIC)
  - èŠ±å±æ£€æµ‹ (DISTORTION)
  - ä¿¡å·ä¸¢å¤±æ£€æµ‹ (SIGNAL_LOSS)
  - è¿‡æ›æ£€æµ‹ (OVEREXPOSURE)
  - æ¬ æ›æ£€æµ‹ (UNDEREXPOSURE)
- **ç»Ÿä¸€è¯„åˆ†**: 0-100åˆ†åˆ¶è¯„åˆ†ç³»ç»Ÿ
- **ä»»åŠ¡è°ƒåº¦**: æ”¯æŒå®šæ—¶å’Œæ‰‹åŠ¨è¯Šæ–­ä»»åŠ¡
- **ç»“æœåˆ†æ**: è¯¦ç»†çš„è¯Šæ–­æŠ¥å‘Šå’Œå»ºè®®

### 5. äº‹ä»¶å‘Šè­¦ä¸­å¿ƒ
- **å®æ—¶å‘Šè­¦**: åŸºäºAIåˆ†æçš„å®æ—¶äº‹ä»¶å‘Šè­¦
- **å‘Šè­¦è§„åˆ™**: çµæ´»çš„å‘Šè­¦è§„åˆ™é…ç½®
- **é€šçŸ¥æ¸ é“**: å¤šç§é€šçŸ¥æ–¹å¼æ”¯æŒ
- **äº‹ä»¶è®°å½•**: å®Œæ•´çš„äº‹ä»¶å†å²è®°å½•

### 6. ç³»ç»Ÿé…ç½®ç®¡ç†
- **ç‰ˆæœ¬ä¿¡æ¯**: ç³»ç»Ÿç‰ˆæœ¬å’Œæ›´æ–°ä¿¡æ¯
- **å­˜å‚¨é…ç½®**: æ•°æ®ä¿ç•™ç­–ç•¥é…ç½®
- **æµåª’ä½“ç®¡ç†**: æµåª’ä½“èŠ‚ç‚¹ç®¡ç†
- **æ¶ˆæ¯ä¸­å¿ƒ**: æ¶ˆæ¯æ¨é€é…ç½®
- **ç³»ç»Ÿç›‘æ§**: ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ç›‘æ§

### 7. ä»ªè¡¨ç›˜
- **æ•°æ®å¯è§†åŒ–**: åŸºäºEChartsçš„æ•°æ®å±•ç¤º
- **å®æ—¶ç»Ÿè®¡**: ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ç»Ÿè®¡
- **æ€§èƒ½ç›‘æ§**: ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡å±•ç¤º
- **è¶‹åŠ¿åˆ†æ**: å†å²æ•°æ®è¶‹åŠ¿åˆ†æ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- **Node.js**: >= 16.0.0
- **Yarn**: >= 1.22.0
- **Python**: >= 3.8
- **Docker**: æ¨èä½¿ç”¨Docker & Docker Compose
- **æ“ä½œç³»ç»Ÿ**: Linux, Windows, macOS

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd EasySight
```

### 2. å¯åŠ¨åŸºç¡€æœåŠ¡
```bash
# å¯åŠ¨æ•°æ®åº“ã€ç¼“å­˜ã€å¯¹è±¡å­˜å‚¨ç­‰åŸºç¡€æœåŠ¡
docker-compose up -d
```

### 3. åç«¯æœåŠ¡éƒ¨ç½²
```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (Windows)
.venv\Scripts\activate
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (Linux/macOS)
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### 4. å‰ç«¯æœåŠ¡éƒ¨ç½²
```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd web

# å®‰è£…ä¾èµ–
yarn install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
yarn dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
yarn build
```

### 5. æµåª’ä½“æœåŠ¡éƒ¨ç½²
```bash
# è¿›å…¥æµåª’ä½“æœåŠ¡ç›®å½•
cd zlmediakitServer

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨æœåŠ¡
python main.py
```

### 6. é»˜è®¤ç™»å½•ä¿¡æ¯
- **ç®¡ç†å‘˜è´¦å·**: admin
- **ç®¡ç†å‘˜å¯†ç **: admin123

## ğŸ“ é¡¹ç›®ç»“æ„

```
EasySight/
â”œâ”€â”€ README.md                          # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ docker-compose.yaml                # Dockerç¼–æ’æ–‡ä»¶
â”œâ”€â”€ QUICK_START_WORKER.md              # Workerå¿«é€Ÿå¯åŠ¨æŒ‡å—
â”œâ”€â”€ PROJECT_DOCUMENTATION.md           # å®Œæ•´é¡¹ç›®è¯´æ˜ä¹¦
â”œâ”€â”€ backend/                           # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ main.py                       # ä¸»åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py                     # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ database.py                   # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ requirements.txt              # Pythonä¾èµ–
â”‚   â”œâ”€â”€ alembic/                      # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ models/                       # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routers/                      # APIè·¯ç”±
â”‚   â”œâ”€â”€ middleware/                   # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ diagnosis/                    # è¯Šæ–­ç³»ç»Ÿ
â”‚   â”œâ”€â”€ tasks/                        # åå°ä»»åŠ¡
â”‚   â”œâ”€â”€ utils/                        # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ scripts/                      # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ algorithms_cache/             # ç®—æ³•ç¼“å­˜
â”‚   â”œâ”€â”€ packages/                     # ç®—æ³•åŒ…
â”‚   â””â”€â”€ *.md                         # æŠ€æœ¯æ–‡æ¡£
â”œâ”€â”€ web/                              # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/                         # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ views/                   # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/              # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ api/                     # APIæ¥å£
â”‚   â”‚   â”œâ”€â”€ stores/                  # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ router/                  # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ types/                   # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ public/                      # é™æ€èµ„æº
â”‚   â”œâ”€â”€ package.json                 # å‰ç«¯ä¾èµ–
â”‚   â””â”€â”€ vite.config.ts              # Viteé…ç½®
â”œâ”€â”€ zlmediakitServer/                 # æµåª’ä½“æœåŠ¡
â”‚   â”œâ”€â”€ main.py                      # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ config.py                    # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–
â”‚   â”œâ”€â”€ utils/                       # å·¥å…·æ¨¡å—
â”‚   â””â”€â”€ *.md                        # æœåŠ¡æ–‡æ¡£
â”œâ”€â”€ example-algorithm-package/        # ç®—æ³•åŒ…ç¤ºä¾‹
â””â”€â”€ data/                            # æ•°æ®ç›®å½•
    â”œâ”€â”€ postgres_data/               # PostgreSQLæ•°æ®
    â”œâ”€â”€ minio_data/                  # MinIOæ•°æ®
    â””â”€â”€ mysql_data/                  # MySQLæ•°æ®(å¯é€‰)
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

#### åç«¯é…ç½® (backend/.env)
```env
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://rotanova:RotaNova%402025@127.0.0.1:5432/easysight

# Redisé…ç½®
REDIS_URL=redis://127.0.0.1:6379/0

# MinIOé…ç½®
MINIO_ENDPOINT=127.0.0.1:9000
MINIO_ACCESS_KEY=rotanova
MINIO_SECRET_KEY=RotaNova@2025
MINIO_BUCKET_NAME=easysight

# RabbitMQé…ç½®
RABBITMQ_URL=amqp://rotanova:RotaNova@2025@127.0.0.1:5672/

# JWTé…ç½®
SECRET_KEY=your-secret-key-here-change-in-production
ACCESS_TOKEN_EXPIRE_MINUTES=60

# åº”ç”¨é…ç½®
DEBUG=True
MAX_FILE_SIZE=104857600  # 100MB
```

#### æµåª’ä½“æœåŠ¡é…ç½®
```env
# MinIOé…ç½®
minio_host=192.168.2.177:9000

# MySQLé…ç½®
mysql_host=192.168.2.177

# ZLMediaKité…ç½®
zlm_host=192.168.2.177

# æ—¥å¿—é…ç½®
LOG_DEBUG=False
LOG_FILE=logs/mediaworker.log
```

### ç«¯å£é…ç½®

| æœåŠ¡ | ç«¯å£ | ç”¨é€” |
|------|------|------|
| å‰ç«¯å¼€å‘æœåŠ¡å™¨ | 5173 | Vueå¼€å‘æœåŠ¡å™¨ |
| åç«¯APIæœåŠ¡ | 8000 | FastAPIæœåŠ¡ |
| æµåª’ä½“æœåŠ¡ | 18080 | æµåª’ä½“ç®¡ç†API |
| ZLMediaKit | 8060 | åª’ä½“æœåŠ¡å™¨API |
| PostgreSQL | 5432 | æ•°æ®åº“ |
| Redis | 6379 | ç¼“å­˜ |
| MinIO | 9000/9001 | å¯¹è±¡å­˜å‚¨ |
| RabbitMQ | 5672/15672 | æ¶ˆæ¯é˜Ÿåˆ— |
| RTSP | 554 | è§†é¢‘æµæ¥æ”¶ |
| RTMP | 1935 | ç›´æ’­æ¨æµ |

## ğŸ¤– AIç®—æ³•å¼€å‘æŒ‡å—

### å®Œæ•´è¯Šæ–­ç®—æ³•å®ç°

EasySight ç³»ç»Ÿç°å·²å®ç°äº†å®Œæ•´çš„ 14 ç§è¯Šæ–­ç®—æ³•ï¼Œè¦†ç›–äº†è§†é¢‘ç›‘æ§ç³»ç»Ÿä¸­å¸¸è§çš„å„ç§å›¾åƒè´¨é‡é—®é¢˜ã€‚æ‰€æœ‰ç®—æ³•éƒ½é‡‡ç”¨ç»Ÿä¸€çš„ 0-100 åˆ†åˆ¶è¯„åˆ†ç³»ç»Ÿï¼Œåˆ†æ•°è¶Šé«˜è¡¨ç¤ºè´¨é‡è¶Šå¥½ã€‚

#### åŸºç¡€è´¨é‡æ£€æµ‹ç®—æ³•

**1. äº®åº¦æ£€æµ‹ (BRIGHTNESS)**
- **åŠŸèƒ½**: æ£€æµ‹å›¾åƒäº®åº¦æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…
- **ç®—æ³•**: è®¡ç®—å›¾åƒå¹³å‡äº®åº¦ï¼Œæ ¹æ®é˜ˆå€¼èŒƒå›´è¯„åˆ†
- **è¯„åˆ†é€»è¾‘**:
  - è¿‡ä½/è¿‡é«˜ (< 30 æˆ– > 220): 0-60åˆ†
  - æ­£å¸¸èŒƒå›´: 60-100åˆ†ï¼Œè·ç¦»æœ€ä½³å€¼è¶Šè¿‘åˆ†æ•°è¶Šé«˜
- **é…ç½®å‚æ•°**:
  - `brightness_min`: æœ€ä½äº®åº¦é˜ˆå€¼ (é»˜è®¤: 30)
  - `brightness_max`: æœ€é«˜äº®åº¦é˜ˆå€¼ (é»˜è®¤: 220)

**2. æ¸…æ™°åº¦æ£€æµ‹ (CLARITY)**
- **åŠŸèƒ½**: æ£€æµ‹å›¾åƒæ¸…æ™°åº¦
- **ç®—æ³•**: ä½¿ç”¨ Laplacian ç®—å­è®¡ç®—å›¾åƒé”åº¦
- **è¯„åˆ†é€»è¾‘**:
  - æ¨¡ç³Š (< 100): 0-60åˆ†
  - æ­£å¸¸: 60-95åˆ†
  - ä¼˜ç§€ (â‰¥ 500): 95-100åˆ†
- **é…ç½®å‚æ•°**:
  - `clarity_min`: æœ€ä½æ¸…æ™°åº¦é˜ˆå€¼ (é»˜è®¤: 100)
  - `clarity_excellent`: ä¼˜ç§€æ¸…æ™°åº¦é˜ˆå€¼ (é»˜è®¤: 500)

**3. å¯¹æ¯”åº¦æ£€æµ‹ (CONTRAST)**
- **åŠŸèƒ½**: æ£€æµ‹å›¾åƒå¯¹æ¯”åº¦
- **ç®—æ³•**: è®¡ç®—å›¾åƒç°åº¦å€¼æ ‡å‡†å·®
- **è¯„åˆ†é€»è¾‘**:
  - è¿‡ä½ (< 20): 0-60åˆ†
  - æ­£å¸¸: 60-95åˆ†
  - ä¼˜ç§€ (â‰¥ 60): 95-100åˆ†
- **é…ç½®å‚æ•°**:
  - `contrast_min`: æœ€ä½å¯¹æ¯”åº¦é˜ˆå€¼ (é»˜è®¤: 20)
  - `contrast_excellent`: ä¼˜ç§€å¯¹æ¯”åº¦é˜ˆå€¼ (é»˜è®¤: 60)

**4. å™ªå£°æ£€æµ‹ (NOISE)**
- **åŠŸèƒ½**: æ£€æµ‹å›¾åƒå™ªå£°æ°´å¹³
- **ç®—æ³•**: ä½¿ç”¨é«˜æ–¯æ»¤æ³¢å»å™ªåè®¡ç®—å·®å¼‚
- **è¯„åˆ†é€»è¾‘**:
  - å™ªå£°è¿‡é«˜ (> 15): 0-60åˆ†
  - æ­£å¸¸: 60-95åˆ†
  - ä¼˜ç§€ (â‰¤ 3): 95-100åˆ†
- **é…ç½®å‚æ•°**:
  - `noise_max`: æœ€å¤§å™ªå£°é˜ˆå€¼ (é»˜è®¤: 15)
  - `noise_excellent`: ä¼˜ç§€å™ªå£°é˜ˆå€¼ (é»˜è®¤: 3)

#### ç‰¹æ®Šé—®é¢˜æ£€æµ‹ç®—æ³•

**5. è“å±æ£€æµ‹ (BLUE_SCREEN)**
- **åŠŸèƒ½**: æ£€æµ‹è“å±æ•…éšœ
- **ç®—æ³•**: åœ¨ HSV è‰²å½©ç©ºé—´æ£€æµ‹è“è‰²åŒºåŸŸæ¯”ä¾‹
- **è¯„åˆ†é€»è¾‘**:
  - è“è‰²æ¯”ä¾‹è¿‡é«˜: 0-60åˆ†
  - æ­£å¸¸: 60-100åˆ†
- **é…ç½®å‚æ•°**:
  - `blue_screen_ratio`: è“å±é˜ˆå€¼ (é»˜è®¤: 0.8)

**6. å†»ç»“æ£€æµ‹ (FREEZE)**
- **åŠŸèƒ½**: æ£€æµ‹ç”»é¢å†»ç»“
- **ç®—æ³•**: è®¡ç®—è¿ç»­å¸§é—´å·®å¼‚
- **è¯„åˆ†é€»è¾‘**:
  - ç–‘ä¼¼å†»ç»“ (< 0.01): 0-60åˆ†
  - è½»å¾®å˜åŒ–: 60-95åˆ†
  - æ­£å¸¸å˜åŒ– (â‰¥ 0.05): 95-100åˆ†
- **é…ç½®å‚æ•°**:
  - `freeze_threshold`: å†»ç»“é˜ˆå€¼ (é»˜è®¤: 0.01)
  - `freeze_normal`: æ­£å¸¸å˜åŒ–é˜ˆå€¼ (é»˜è®¤: 0.05)

**7. æŠ–åŠ¨æ£€æµ‹ (JITTER)**
- **åŠŸèƒ½**: æ£€æµ‹å›¾åƒæŠ–åŠ¨
- **ç®—æ³•**: ç»“åˆè¾¹ç¼˜æ£€æµ‹å’Œæ¢¯åº¦æ–¹å·®åˆ†æ
- **è¯„åˆ†é€»è¾‘**:
  - æŠ–åŠ¨ä¸¥é‡ (< 0.5): 0-60åˆ†
  - æ­£å¸¸: 60-95åˆ†
  - éå¸¸ç¨³å®š (â‰¥ 2.0): 95-100åˆ†
- **é…ç½®å‚æ•°**:
  - `jitter_min`: æœ€ä½ç¨³å®šæ€§é˜ˆå€¼ (é»˜è®¤: 0.5)
  - `jitter_excellent`: ä¼˜ç§€ç¨³å®šæ€§é˜ˆå€¼ (é»˜è®¤: 2.0)

**8. åè‰²æ£€æµ‹ (COLOR_CAST)**
- **åŠŸèƒ½**: æ£€æµ‹å›¾åƒåè‰²é—®é¢˜
- **ç®—æ³•**: è®¡ç®— RGB ä¸‰é€šé“å¹³å‡å€¼åå·®
- **è¯„åˆ†é€»è¾‘**:
  - ä¸¥é‡åè‰² (â‰¥ 50): 0-40åˆ†
  - è½»å¾®åè‰² (20-50): 40-60åˆ†
  - é¢œè‰²æ­£å¸¸ (< 20): 60-100åˆ†
- **é…ç½®å‚æ•°**:
  - `color_cast_threshold`: åè‰²é˜ˆå€¼ (é»˜è®¤: 20)
  - `color_cast_severe`: ä¸¥é‡åè‰²é˜ˆå€¼ (é»˜è®¤: 50)

**9. é®æŒ¡æ£€æµ‹ (OCCLUSION)**
- **åŠŸèƒ½**: æ£€æµ‹é•œå¤´é®æŒ¡
- **ç®—æ³•**: ç»“åˆæš—åŒºåŸŸæ£€æµ‹å’Œè¾¹ç¼˜å¯†åº¦åˆ†æ
- **è¯„åˆ†é€»è¾‘**:
  - ä¸¥é‡é®æŒ¡ (â‰¥ 0.6): 0-40åˆ†
  - è½»å¾®é®æŒ¡ (0.3-0.6): 40-60åˆ†
  - æ— é®æŒ¡ (< 0.3): 60-100åˆ†
- **é…ç½®å‚æ•°**:
  - `occlusion_threshold`: é®æŒ¡é˜ˆå€¼ (é»˜è®¤: 0.3)
  - `occlusion_severe`: ä¸¥é‡é®æŒ¡é˜ˆå€¼ (é»˜è®¤: 0.6)
  - `occlusion_dark_threshold`: æš—åŒºåŸŸé˜ˆå€¼ (é»˜è®¤: 30)

**10. é©¬èµ›å…‹æ£€æµ‹ (MOSAIC)**
- **åŠŸèƒ½**: æ£€æµ‹é©¬èµ›å…‹åŒ–å¤±çœŸ
- **ç®—æ³•**: ä½¿ç”¨å½¢æ€å­¦æ“ä½œå’Œéœå¤«ç›´çº¿æ£€æµ‹
- **è¯„åˆ†é€»è¾‘**:
  - ä¸¥é‡é©¬èµ›å…‹ (â‰¥ 0.5): 0-40åˆ†
  - è½»å¾®é©¬èµ›å…‹ (0.2-0.5): 40-60åˆ†
  - æ— é©¬èµ›å…‹ (< 0.2): 60-100åˆ†
- **é…ç½®å‚æ•°**:
  - `mosaic_threshold`: é©¬èµ›å…‹é˜ˆå€¼ (é»˜è®¤: 0.2)
  - `mosaic_severe`: ä¸¥é‡é©¬èµ›å…‹é˜ˆå€¼ (é»˜è®¤: 0.5)

**11. èŠ±å±æ£€æµ‹ (DISTORTION)**
- **åŠŸèƒ½**: æ£€æµ‹èŠ±å±æ•…éšœ
- **ç®—æ³•**: åˆ†æé¢œè‰²åˆ†å¸ƒå¼‚å¸¸ã€é¥±å’Œåƒç´ å’Œå™ªå£°æ¨¡å¼
- **è¯„åˆ†é€»è¾‘**:
  - ä¸¥é‡èŠ±å± (â‰¥ 0.6): 0-40åˆ†
  - è½»å¾®èŠ±å± (0.3-0.6): 40-60åˆ†
  - æ— èŠ±å± (< 0.3): 60-100åˆ†
- **é…ç½®å‚æ•°**:
  - `distortion_threshold`: èŠ±å±é˜ˆå€¼ (é»˜è®¤: 0.3)
  - `distortion_severe`: ä¸¥é‡èŠ±å±é˜ˆå€¼ (é»˜è®¤: 0.6)

**12. ä¿¡å·ä¸¢å¤±æ£€æµ‹ (SIGNAL_LOSS)**
- **åŠŸèƒ½**: æ£€æµ‹ä¿¡å·ä¸¢å¤±
- **ç®—æ³•**: æ£€æµ‹å…¨é»‘/å…¨ç™½åŒºåŸŸã€å›¾åƒæ–¹å·®å’Œè¾¹ç¼˜å¯†åº¦
- **è¯„åˆ†é€»è¾‘**:
  - ä¸¥é‡ä¿¡å·ä¸¢å¤± (â‰¥ 0.7): 0-40åˆ†
  - ä¿¡å·ä¸ç¨³å®š (0.3-0.7): 40-60åˆ†
  - ä¿¡å·æ­£å¸¸ (< 0.3): 60-100åˆ†
- **é…ç½®å‚æ•°**:
  - `signal_loss_threshold`: ä¿¡å·ä¸¢å¤±é˜ˆå€¼ (é»˜è®¤: 0.3)
  - `signal_loss_severe`: ä¸¥é‡ä¿¡å·ä¸¢å¤±é˜ˆå€¼ (é»˜è®¤: 0.7)

**13. è¿‡æ›æ£€æµ‹ (OVEREXPOSURE)**
- **åŠŸèƒ½**: æ£€æµ‹å›¾åƒè¿‡æ›
- **ç®—æ³•**: æ£€æµ‹é«˜äº®åº¦åƒç´ æ¯”ä¾‹
- **è¯„åˆ†é€»è¾‘**:
  - ä¸¥é‡è¿‡æ› (â‰¥ 0.3): 0-40åˆ†
  - è½»å¾®è¿‡æ› (0.1-0.3): 40-60åˆ†
  - æ›å…‰æ­£å¸¸ (< 0.1): 60-100åˆ†
- **é…ç½®å‚æ•°**:
  - `overexposure_threshold`: è¿‡æ›é˜ˆå€¼ (é»˜è®¤: 0.1)
  - `overexposure_severe`: ä¸¥é‡è¿‡æ›é˜ˆå€¼ (é»˜è®¤: 0.3)

**14. æ¬ æ›æ£€æµ‹ (UNDEREXPOSURE)**
- **åŠŸèƒ½**: æ£€æµ‹å›¾åƒæ¬ æ›
- **ç®—æ³•**: æ£€æµ‹ä½äº®åº¦åƒç´ æ¯”ä¾‹
- **è¯„åˆ†é€»è¾‘**:
  - ä¸¥é‡æ¬ æ› (â‰¥ 0.5): 0-40åˆ†
  - è½»å¾®æ¬ æ› (0.2-0.5): 40-60åˆ†
  - æ›å…‰æ­£å¸¸ (< 0.2): 60-100åˆ†
- **é…ç½®å‚æ•°**:
  - `underexposure_threshold`: æ¬ æ›é˜ˆå€¼ (é»˜è®¤: 0.2)
  - `underexposure_severe`: ä¸¥é‡æ¬ æ›é˜ˆå€¼ (é»˜è®¤: 0.5)

### ç®—æ³•è¯„åˆ†æ ‡å‡†åŒ–

#### ç»Ÿä¸€è¯„åˆ†æ ‡å‡†
- **è¯„åˆ†èŒƒå›´**: 0-100 åˆ†
- **è¯„åˆ†åŸåˆ™**: åˆ†æ•°è¶Šé«˜è¡¨ç¤ºè´¨é‡è¶Šå¥½
- **çŠ¶æ€åˆ†çº§**:
  - **NORMAL (æ­£å¸¸)**: 60-100 åˆ†
  - **WARNING (è­¦å‘Š)**: 40-59 åˆ†
  - **ERROR/CRITICAL (é”™è¯¯/ä¸¥é‡)**: 0-39 åˆ†

#### è¯„åˆ†åŒºé—´è®¾è®¡
- **0-40åˆ†**: ä¸¥é‡é—®é¢˜ï¼Œéœ€è¦ç«‹å³å¤„ç†
- **40-60åˆ†**: è½»å¾®é—®é¢˜ï¼Œå»ºè®®å…³æ³¨
- **60-95åˆ†**: æ­£å¸¸èŒƒå›´ï¼Œè´¨é‡å¯æ¥å—
- **95-100åˆ†**: ä¼˜ç§€è´¨é‡ï¼Œè¡¨ç°å“è¶Š

### ç®—æ³•åŒ…å¼€å‘è§„èŒƒ

#### ç›®å½•ç»“æ„
```
algorithm_package/
â”œâ”€â”€ __init__.py          # åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”œâ”€â”€ algorithm.py         # ä¸»è¦ç®—æ³•å®ç°
â”œâ”€â”€ config.json         # ç®—æ³•é…ç½®å…ƒæ•°æ®
â””â”€â”€ README.md           # è¯´æ˜æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰
```

#### ç®—æ³•ç±»è§„èŒƒ
```python
class ExampleAlgorithm:
    def __init__(self, config=None):
        """åˆå§‹åŒ–ç®—æ³•"""
        pass
    
    def run(self, data):
        """è¿è¡Œç®—æ³•"""
        return {
            'prediction': 'ç»“æœ',
            'confidence': 0.95,
            'status': 'success'
        }
    
    def get_info(self):
        """è·å–ç®—æ³•ä¿¡æ¯"""
        return {
            'name': 'ç®—æ³•åç§°',
            'version': '1.0.0',
            'description': 'ç®—æ³•æè¿°'
        }

# å·¥å‚å‡½æ•°
def create_algorithm(config=None):
    return ExampleAlgorithm(config)
```

#### é…ç½®æ–‡ä»¶è§„èŒƒ (config.json)
```json
{
  "name": "ç®—æ³•åç§°",
  "code": "algorithm_code",
  "version": "1.0.0",
  "description": "ç®—æ³•æè¿°",
  "author": "ä½œè€…",
  "type": "detection",
  "requirements": {
    "python": ">=3.8",
    "packages": ["numpy>=1.20.0"]
  },
  "parameters": {
    "threshold": {
      "type": "number",
      "default": 0.5,
      "description": "é˜ˆå€¼å‚æ•°"
    }
  },
  "entry_point": {
    "module": "algorithm",
    "class": "ExampleAlgorithm",
    "factory_function": "create_algorithm"
  }
}
```

### åŠ¨æ€åŠ è½½åŠŸèƒ½

EasySight åˆ†å¸ƒå¼Workerç³»ç»Ÿæ”¯æŒåŠ¨æ€åŠ è½½ç®—æ³•åŒ…åŠŸèƒ½ï¼ŒWorkerèŠ‚ç‚¹å¯ä»¥åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨ä»ä¸»æœåŠ¡å™¨è·å–ç®—æ³•åŒ…åˆ—è¡¨ï¼Œä¸‹è½½å¹¶å®‰è£…ç¼ºå¤±çš„ç®—æ³•åŒ…ï¼Œå¹¶åŠ¨æ€å¯¼å…¥ç®—æ³•æ¨¡å—ï¼Œæ— éœ€é‡å¯WorkerèŠ‚ç‚¹ã€‚

#### åŠŸèƒ½ç‰¹æ€§
- **è‡ªåŠ¨åŒæ­¥**: WorkerèŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨ä»ä¸»æœåŠ¡å™¨è·å–ç®—æ³•åŒ…åˆ—è¡¨
- **åŠ¨æ€å¯¼å…¥**: è¿è¡Œæ—¶åŠ¨æ€å¯¼å…¥ç®—æ³•æ¨¡å—ï¼Œæ— éœ€é‡å¯WorkerèŠ‚ç‚¹
- **ç¼“å­˜ç®¡ç†**: æœ¬åœ°ç¼“å­˜å·²ä¸‹è½½çš„ç®—æ³•åŒ…ï¼Œé¿å…é‡å¤ä¸‹è½½

#### ç®—æ³•åŒ…ç¼“å­˜ç›®å½•ç»“æ„
```
algorithms_cache/
â”œâ”€â”€ algorithm_code_1/
â”‚   â”œâ”€â”€ 1.0.0/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ algorithm.py
â”‚   â”‚   â””â”€â”€ config.json
â”‚   â””â”€â”€ 1.1.0/
â””â”€â”€ algorithm_code_2/
    â””â”€â”€ 2.0.0/
```

### é˜ˆå€¼é…ç½®å¢å¼º

#### é…ç½®ä¼ é€’æœºåˆ¶
ç³»ç»Ÿæ”¯æŒä»è¯Šæ–­æ¨¡æ¿åˆ°ç®—æ³•å®ä¾‹çš„é˜ˆå€¼é…ç½®ä¼ é€’ï¼Œç¡®ä¿å‰ç«¯æ¨¡æ¿ä¸­è®¾ç½®çš„é˜ˆå€¼èƒ½æ­£ç¡®ä¼ é€’åˆ°ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ã€‚

#### é…ç½®æ˜ å°„è§„åˆ™
| è¯Šæ–­ç±»å‹ | å‰ç«¯å­—æ®µ | ç®—æ³•å‚æ•° | è½¬æ¢è§„åˆ™ |
|---------|---------|---------|----------|
| clarity | threshold (0-1) | clarity_min | ä¹˜ä»¥100 |
| brightness | threshold (0-1) | brightness_min | ç›´æ¥ä½¿ç”¨ |
| contrast | threshold (0-1) | contrast_min | ç›´æ¥ä½¿ç”¨ |
| noise | threshold (0-1) | noise_max | ç›´æ¥ä½¿ç”¨ |

### ä½¿ç”¨ç¤ºä¾‹

#### å•ä¸ªç®—æ³•ä½¿ç”¨
```python
from diagnosis.algorithms import BrightnessAlgorithm
import cv2

# åŠ è½½å›¾åƒ
image = cv2.imread('test_image.jpg')

# åˆ›å»ºç®—æ³•å®ä¾‹
algorithm = BrightnessAlgorithm({
    'thresholds': {
        'brightness_min': 30,
        'brightness_max': 220
    }
})

# æ‰§è¡Œè¯Šæ–­
result = algorithm.diagnose(image)
print(f"è¯„åˆ†: {result['score']}, çŠ¶æ€: {result['status']}")
```

#### æ‰¹é‡è¯Šæ–­
```python
from models.diagnosis import DiagnosisType
from diagnosis.algorithms import get_algorithm

# å®šä¹‰è¦æ‰§è¡Œçš„è¯Šæ–­ç±»å‹
diagnosis_types = [
    DiagnosisType.BRIGHTNESS,
    DiagnosisType.CLARITY,
    DiagnosisType.BLUE_SCREEN,
    DiagnosisType.NOISE,
    DiagnosisType.CONTRAST
]

# æ‰¹é‡æ‰§è¡Œè¯Šæ–­
results = {}
for diagnosis_type in diagnosis_types:
    algorithm = get_algorithm(diagnosis_type)
    result = algorithm.diagnose(image)
    results[diagnosis_type.value] = result
```

## ğŸ”„ åˆ†å¸ƒå¼Workeréƒ¨ç½²

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»æœåŠ¡å™¨       â”‚    â”‚   WorkerèŠ‚ç‚¹1    â”‚    â”‚   WorkerèŠ‚ç‚¹2    â”‚
â”‚  (è°ƒåº¦å™¨)       â”‚â—„â”€â”€â–ºâ”‚  (ä»»åŠ¡æ‰§è¡Œ)     â”‚    â”‚  (ä»»åŠ¡æ‰§è¡Œ)     â”‚
â”‚                â”‚    â”‚                â”‚    â”‚                â”‚
â”‚ - ä»»åŠ¡è°ƒåº¦      â”‚    â”‚ - æ³¨å†Œ/å¿ƒè·³     â”‚    â”‚ - æ³¨å†Œ/å¿ƒè·³     â”‚
â”‚ - ä»»åŠ¡åˆ†é…      â”‚    â”‚ - ä»»åŠ¡è·å–      â”‚    â”‚ - ä»»åŠ¡è·å–      â”‚
â”‚ - Workerç®¡ç†    â”‚    â”‚ - ä»»åŠ¡æ‰§è¡Œ      â”‚    â”‚ - ä»»åŠ¡æ‰§è¡Œ      â”‚
â”‚ - çŠ¶æ€ç›‘æ§      â”‚    â”‚ - çŠ¶æ€æŠ¥å‘Š      â”‚    â”‚ - çŠ¶æ€æŠ¥å‘Š      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¿«é€Ÿå¼€å§‹

#### å¯åŠ¨ä¸»æœåŠ¡
é¦–å…ˆç¡®ä¿ä¸»æœåŠ¡æ­£åœ¨è¿è¡Œï¼š
```bash
cd backend
python -m uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

#### å¯åŠ¨WorkerèŠ‚ç‚¹

**æ–¹å¼ä¸€ï¼šç›´æ¥å¯åŠ¨ï¼ˆæ¨èï¼‰**
```bash
# åŸºæœ¬å¯åŠ¨ï¼ˆè¿æ¥åˆ°æœ¬åœ°ä¸»æœåŠ¡ï¼‰
python start_distributed_worker.py

# è¿æ¥åˆ°è¿œç¨‹ä¸»æœåŠ¡
python start_distributed_worker.py --server-url http://192.168.1.100:8000

# è‡ªå®šä¹‰é…ç½®
python start_distributed_worker.py \
  --worker-pool-size 5 \
  --max-concurrent-tasks 3 \
  --node-name ProductionWorker \
  --log-level INFO
```

**æ–¹å¼äºŒï¼šä½¿ç”¨é…ç½®æ–‡ä»¶**
```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿
cp worker.env.example worker.env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
# worker.env
server_url=http://localhost:8000
worker_pool_size=3
max_concurrent_tasks=2
node_name=MyWorker
log_level=INFO

# ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨
python start_distributed_worker.py --config worker.env
```

### é…ç½®å‚æ•°

#### åŸºæœ¬é…ç½®
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|---------|
| `--config` | - | é…ç½®æ–‡ä»¶è·¯å¾„ (.envæ ¼å¼) |
| `--server-url` | `http://localhost:8000` | ä¸»æœåŠ¡å™¨URL |
| `--api-token` | - | APIè®¤è¯ä»¤ç‰Œ |

#### Workeré…ç½®
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|---------|
| `--worker-pool-size` | `3` | Workeræ± å¤§å° |
| `--max-concurrent-tasks` | `2` | æ¯ä¸ªWorkeræœ€å¤§å¹¶å‘ä»»åŠ¡æ•° |
| `--node-name` | `Worker-<hostname>` | èŠ‚ç‚¹åç§° |
| `--node-id` | è‡ªåŠ¨ç”Ÿæˆ | èŠ‚ç‚¹ID |

#### ä»»åŠ¡é…ç½®
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|---------|
| `--task-poll-interval` | `5` | ä»»åŠ¡è½®è¯¢é—´éš”ï¼ˆç§’ï¼‰ |
| `--heartbeat-interval` | `30` | å¿ƒè·³é—´éš”ï¼ˆç§’ï¼‰ |
| `--max-retries` | `3` | æœ€å¤§é‡è¯•æ¬¡æ•° |

#### æ—¥å¿—é…ç½®
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|---------|
| `--log-level` | `INFO` | æ—¥å¿—çº§åˆ« (DEBUG/INFO/WARNING/ERROR) |
| `--log-file` | - | æ—¥å¿—æ–‡ä»¶è·¯å¾„ (é»˜è®¤ä»…æ§åˆ¶å°è¾“å‡º) |

### åŠŸèƒ½ç‰¹æ€§

#### è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°
- WorkerèŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å†Œåˆ°ä¸»æœåŠ¡
- å®šæœŸå‘é€å¿ƒè·³ä¿æŒè¿æ¥
- ä¸»æœåŠ¡é‡å¯åè‡ªåŠ¨é‡æ–°æ³¨å†Œ

#### æ™ºèƒ½ä»»åŠ¡åˆ†é…
- ä¼˜å…ˆåˆ†é…ç»™å¯ç”¨çš„WorkerèŠ‚ç‚¹
- æ”¯æŒä»»åŠ¡äº²å’Œæ€§ï¼ˆåˆ†é…ç»™ç‰¹å®šWorkerï¼‰
- è´Ÿè½½å‡è¡¡å’Œå®¹é”™å¤„ç†

#### å®æ—¶ç›‘æ§
- WorkerèŠ‚ç‚¹çŠ¶æ€ç›‘æ§
- ä»»åŠ¡æ‰§è¡Œç»Ÿè®¡
- ç³»ç»Ÿèµ„æºç›‘æ§

### Workeré‡è¿æœºåˆ¶

#### é—®é¢˜èƒŒæ™¯
å½“ä¸»æœåŠ¡é‡å¯æ—¶ï¼Œå·²è¿æ¥çš„WorkerèŠ‚ç‚¹ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š
- 404é”™è¯¯æŒç»­å‡ºç°
- æ— æ³•è‡ªåŠ¨é‡è¿
- è¿æ¥çŠ¶æ€ä¸ä¸€è‡´

#### è§£å†³æ–¹æ¡ˆ

**è‡ªåŠ¨é‡æ–°æ³¨å†Œæœºåˆ¶**
```python
# å¿ƒè·³å‘é€æ—¶æ£€æµ‹404é”™è¯¯
elif response.status == 404:
    # ä¸»æœåŠ¡é‡å¯å¯¼è‡´èŠ‚ç‚¹æœªæ³¨å†Œï¼Œè‡ªåŠ¨é‡æ–°æ³¨å†Œ
    logger.warning(f"èŠ‚ç‚¹æœªæ³¨å†Œ(404)ï¼Œå°è¯•é‡æ–°æ³¨å†Œ: {self.config.node_id}")
    await self._register_node()
```

**æ”¹è¿›æ³¨å†Œé€»è¾‘**
- æ·»åŠ é‡è¯•æœºåˆ¶å’Œæ›´å¥½çš„é”™è¯¯å¤„ç†
- æ”¯æŒé‡å¤æ³¨å†Œå¹¶ä¿ç•™ç»Ÿè®¡ä¿¡æ¯
- ç‹¬ç«‹çš„è¿æ¥ç›‘æ§å¾ªç¯

### éªŒè¯WorkerçŠ¶æ€

è®¿é—®ä¸»æœåŠ¡çš„APIæ¥æ£€æŸ¥WorkerçŠ¶æ€ï¼š
```bash
# è·å–Workerç»Ÿè®¡ä¿¡æ¯
curl http://localhost:8000/api/diagnosis/workers/stats

# è·å–åœ¨çº¿Workeråˆ—è¡¨
curl http://localhost:8000/api/diagnosis/workers
```

### æ€§èƒ½ä¼˜åŒ–

#### ç³»ç»Ÿé…ç½®
- **å¿ƒè·³é—´éš”**: 30ç§’
- **ä»»åŠ¡è·å–é—´éš”**: 5ç§’
- **æœ€å¤§é‡è¯•æ¬¡æ•°**: 3æ¬¡
- **ä»»åŠ¡æ‰¹é‡å¤§å°**: æœ€å¤š5ä¸ªä»»åŠ¡

#### èµ„æºç›‘æ§
- CPUæ ¸å¿ƒæ•°è‡ªåŠ¨æ£€æµ‹
- å¯ç”¨å†…å­˜ç›‘æ§
- ç½‘ç»œè¿æ¥çŠ¶æ€æ£€æŸ¥

### Dockeréƒ¨ç½²

#### æ„å»ºWorkeré•œåƒ
```bash
# æ„å»ºWorker Dockeré•œåƒ
docker build -f Dockerfile.worker -t easysight-worker .
```

#### è¿è¡ŒWorkerå®¹å™¨
```bash
# è¿è¡ŒWorkerå®¹å™¨
docker run -d \
  --name easysight-worker-1 \
  -e SERVER_URL=http://host.docker.internal:8000 \
  -e WORKER_POOL_SIZE=3 \
  -e MAX_CONCURRENT_TASKS=2 \
  easysight-worker
```

#### ä½¿ç”¨Docker Compose
```yaml
# docker-compose.worker.yml
version: '3.8'
services:
  worker:
    build:
      context: .
      dockerfile: Dockerfile.worker
    environment:
      - SERVER_URL=http://backend:8000
      - WORKER_POOL_SIZE=3
      - MAX_CONCURRENT_TASKS=2
      - NODE_NAME=DockerWorker
    depends_on:
      - backend
    restart: unless-stopped
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### ç³»ç»ŸæœåŠ¡é…ç½®
```bash
# å¤åˆ¶æœåŠ¡æ–‡ä»¶
sudo cp scripts/easysight-worker.service /etc/systemd/system/

# å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl enable easysight-worker
sudo systemctl start easysight-worker

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status easysight-worker
```

#### éƒ¨ç½²è„šæœ¬
```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬
bash scripts/deploy_worker.sh
```

### æ•…éšœæ’é™¤

#### å¸¸è§é—®é¢˜
1. **è¿æ¥å¤±è´¥**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®
2. **æ³¨å†Œå¤±è´¥**: éªŒè¯æœåŠ¡å™¨URLå’ŒAPIä»¤ç‰Œ
3. **ä»»åŠ¡æ‰§è¡Œå¤±è´¥**: æ£€æŸ¥ç®—æ³•åŒ…å’Œä¾èµ–
4. **æ€§èƒ½é—®é¢˜**: è°ƒæ•´Workeræ± å¤§å°å’Œå¹¶å‘æ•°

#### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹Workeræ—¥å¿—
tail -f worker.log

# æŸ¥çœ‹ç³»ç»ŸæœåŠ¡æ—¥å¿—
sudo journalctl -u easysight-worker -f
```

## ğŸ“Š ç³»ç»Ÿç›‘æ§

### æ€§èƒ½æŒ‡æ ‡
- **CPUä½¿ç”¨ç‡**: ç³»ç»ŸCPUå ç”¨æƒ…å†µ
- **å†…å­˜ä½¿ç”¨ç‡**: ç³»ç»Ÿå†…å­˜å ç”¨æƒ…å†µ
- **ç£ç›˜ä½¿ç”¨ç‡**: å­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µ
- **ç½‘ç»œæµé‡**: ç½‘ç»œå¸¦å®½ä½¿ç”¨æƒ…å†µ
- **ä»»åŠ¡å¤„ç†é‡**: AIä»»åŠ¡å¤„ç†ç»Ÿè®¡
- **é”™è¯¯ç‡**: ç³»ç»Ÿé”™è¯¯ç»Ÿè®¡

### æ—¥å¿—ç®¡ç†
- **åº”ç”¨æ—¥å¿—**: åº”ç”¨è¿è¡Œæ—¥å¿—
- **è®¿é—®æ—¥å¿—**: APIè®¿é—®æ—¥å¿—
- **é”™è¯¯æ—¥å¿—**: ç³»ç»Ÿé”™è¯¯æ—¥å¿—
- **è¯Šæ–­æ—¥å¿—**: AIè¯Šæ–­ä»»åŠ¡æ—¥å¿—
- **Workeræ—¥å¿—**: åˆ†å¸ƒå¼Workerè¿è¡Œæ—¥å¿—

### å¥åº·æ£€æŸ¥
```bash
# æ£€æŸ¥ä¸»æœåŠ¡
curl http://localhost:8000/health

# æ£€æŸ¥æµåª’ä½“æœåŠ¡
curl http://localhost:18080/health

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
psql -h localhost -U rotanova -d easysight -c "SELECT 1;"

# æ£€æŸ¥Redisè¿æ¥
redis-cli ping
```

## ğŸ”„ ä»»åŠ¡æ¢å¤æŒ‡å—

### æ¦‚è¿°

EasySight è¯Šæ–­ä»»åŠ¡æ¢å¤æœºåˆ¶æä¾›äº†å¼ºå¤§çš„ä»»åŠ¡ç®¡ç†åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·åœ¨ç³»ç»Ÿæ•…éšœã€ç½‘ç»œä¸­æ–­æˆ–å…¶ä»–å¼‚å¸¸æƒ…å†µåæ¢å¤å’Œé‡æ–°æ‰§è¡Œè¯Šæ–­ä»»åŠ¡ã€‚

### APIç«¯ç‚¹

#### 1. æ¢å¤å•ä¸ªä»»åŠ¡
```http
POST /api/diagnosis/tasks/{task_id}/recover
```

**è¯·æ±‚å‚æ•°ï¼š**
- `task_id` (è·¯å¾„å‚æ•°): è¦æ¢å¤çš„ä»»åŠ¡ID

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "ä»»åŠ¡æ¢å¤æˆåŠŸ",
  "task_id": "12345",
  "new_status": "pending"
}
```

#### 2. æ‰¹é‡æ¢å¤ä»»åŠ¡
```http
POST /api/diagnosis/tasks/recover/batch
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "task_ids": ["12345", "12346", "12347"],
  "force_recover": false
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "æ‰¹é‡æ¢å¤å®Œæˆ",
  "recovered_count": 2,
  "failed_count": 1,
  "details": [
    {
      "task_id": "12345",
      "status": "recovered",
      "message": "ä»»åŠ¡æ¢å¤æˆåŠŸ"
    },
    {
      "task_id": "12346",
      "status": "recovered",
      "message": "ä»»åŠ¡æ¢å¤æˆåŠŸ"
    },
    {
      "task_id": "12347",
      "status": "failed",
      "message": "ä»»åŠ¡å·²å®Œæˆï¼Œæ— éœ€æ¢å¤"
    }
  ]
}
```

#### 3. æŒ‰æ¡ä»¶æ¢å¤ä»»åŠ¡
```http
POST /api/diagnosis/tasks/recover/by-criteria
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "status": ["failed", "timeout"],
  "camera_ids": [1, 2, 3],
  "start_time": "2024-01-01T00:00:00Z",
  "end_time": "2024-01-31T23:59:59Z",
  "algorithm_types": ["blue_screen", "black_screen"]
}
```

### ä½¿ç”¨åœºæ™¯

#### 1. ç³»ç»Ÿæ•…éšœåæ¢å¤
å½“ç³»ç»Ÿå› ä¸ºç¡¬ä»¶æ•…éšœã€è½¯ä»¶å´©æºƒæˆ–å…¶ä»–åŸå› åœæœºåï¼Œå¯ä»¥ä½¿ç”¨ä»»åŠ¡æ¢å¤åŠŸèƒ½é‡æ–°æ‰§è¡Œæœªå®Œæˆçš„ä»»åŠ¡ï¼š

```bash
# æ¢å¤æ‰€æœ‰å¤±è´¥çš„ä»»åŠ¡
curl -X POST "http://localhost:8000/api/diagnosis/tasks/recover/by-criteria" \
  -H "Content-Type: application/json" \
  -d '{
    "status": ["failed", "timeout", "error"]
  }'
```

#### 2. ç½‘ç»œä¸­æ–­åæ¢å¤
å½“ç½‘ç»œä¸­æ–­å¯¼è‡´ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ—¶ï¼Œå¯ä»¥æ‰¹é‡æ¢å¤ç›¸å…³ä»»åŠ¡ï¼š

```bash
# æ¢å¤ç‰¹å®šæ—¶é—´æ®µå†…çš„å¤±è´¥ä»»åŠ¡
curl -X POST "http://localhost:8000/api/diagnosis/tasks/recover/by-criteria" \
  -H "Content-Type: application/json" \
  -d '{
    "status": ["failed"],
    "start_time": "2024-01-15T10:00:00Z",
    "end_time": "2024-01-15T12:00:00Z"
  }'
```

#### 3. ç‰¹å®šæ‘„åƒå¤´ä»»åŠ¡æ¢å¤
å½“æŸä¸ªæ‘„åƒå¤´å‡ºç°é—®é¢˜åæ¢å¤æ­£å¸¸ï¼Œå¯ä»¥æ¢å¤è¯¥æ‘„åƒå¤´çš„ç›¸å…³ä»»åŠ¡ï¼š

```bash
# æ¢å¤ç‰¹å®šæ‘„åƒå¤´çš„å¤±è´¥ä»»åŠ¡
curl -X POST "http://localhost:8000/api/diagnosis/tasks/recover/by-criteria" \
  -H "Content-Type: application/json" \
  -d '{
    "camera_ids": [5],
    "status": ["failed", "timeout"]
  }'
```

#### 4. ç®—æ³•æ›´æ–°åé‡æ–°æ‰§è¡Œ
å½“ç®—æ³•æ›´æ–°åï¼Œå¯èƒ½éœ€è¦é‡æ–°æ‰§è¡Œä¹‹å‰çš„ä»»åŠ¡ä»¥è·å¾—æ›´å‡†ç¡®çš„ç»“æœï¼š

```bash
# æ¢å¤ç‰¹å®šç®—æ³•ç±»å‹çš„ä»»åŠ¡
curl -X POST "http://localhost:8000/api/diagnosis/tasks/recover/by-criteria" \
  -H "Content-Type: application/json" \
  -d '{
    "algorithm_types": ["blue_screen"],
    "start_time": "2024-01-01T00:00:00Z"
  }'
```

### å‰ç«¯é›†æˆå»ºè®®

#### 1. ä»»åŠ¡åˆ—è¡¨é¡µé¢
åœ¨ä»»åŠ¡åˆ—è¡¨é¡µé¢æ·»åŠ æ¢å¤æŒ‰é’®ï¼š

```javascript
// å•ä¸ªä»»åŠ¡æ¢å¤
async function recoverTask(taskId) {
  try {
    const response = await fetch(`/api/diagnosis/tasks/${taskId}/recover`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    if (result.success) {
      showMessage('ä»»åŠ¡æ¢å¤æˆåŠŸ', 'success');
      refreshTaskList();
    } else {
      showMessage(result.message, 'error');
    }
  } catch (error) {
    showMessage('æ¢å¤ä»»åŠ¡æ—¶å‘ç”Ÿé”™è¯¯', 'error');
  }
}

// æ‰¹é‡ä»»åŠ¡æ¢å¤
async function batchRecoverTasks(taskIds) {
  try {
    const response = await fetch('/api/diagnosis/tasks/recover/batch', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({
        task_ids: taskIds,
        force_recover: false
      })
    });
    
    const result = await response.json();
    showMessage(`æˆåŠŸæ¢å¤ ${result.recovered_count} ä¸ªä»»åŠ¡`, 'success');
    refreshTaskList();
  } catch (error) {
    showMessage('æ‰¹é‡æ¢å¤ä»»åŠ¡æ—¶å‘ç”Ÿé”™è¯¯', 'error');
  }
}
```

#### 2. ç³»ç»Ÿç®¡ç†é¡µé¢
åœ¨ç³»ç»Ÿç®¡ç†é¡µé¢æ·»åŠ é«˜çº§æ¢å¤åŠŸèƒ½ï¼š

```javascript
// æŒ‰æ¡ä»¶æ¢å¤ä»»åŠ¡
async function recoverTasksByCriteria(criteria) {
  try {
    const response = await fetch('/api/diagnosis/tasks/recover/by-criteria', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(criteria)
    });
    
    const result = await response.json();
    if (result.success) {
      showMessage(`æˆåŠŸæ¢å¤ ${result.recovered_count} ä¸ªä»»åŠ¡`, 'success');
      if (result.failed_count > 0) {
        showMessage(`${result.failed_count} ä¸ªä»»åŠ¡æ¢å¤å¤±è´¥`, 'warning');
      }
    }
  } catch (error) {
    showMessage('æ¢å¤ä»»åŠ¡æ—¶å‘ç”Ÿé”™è¯¯', 'error');
  }
}
```

#### 3. ç”¨æˆ·ç•Œé¢å»ºè®®

**ä»»åŠ¡çŠ¶æ€æŒ‡ç¤ºå™¨ï¼š**
- ä½¿ç”¨ä¸åŒé¢œè‰²è¡¨ç¤ºä»»åŠ¡çŠ¶æ€ï¼ˆæˆåŠŸã€å¤±è´¥ã€è¿›è¡Œä¸­ã€å¾…æ¢å¤ï¼‰
- ä¸ºå¤±è´¥çš„ä»»åŠ¡æ˜¾ç¤ºæ¢å¤æŒ‰é’®
- æ”¯æŒå¤šé€‰è¿›è¡Œæ‰¹é‡æ¢å¤

**æ¢å¤å†å²è®°å½•ï¼š**
- è®°å½•ä»»åŠ¡æ¢å¤æ“ä½œçš„å†å²
- æ˜¾ç¤ºæ¢å¤æ—¶é—´ã€æ“ä½œç”¨æˆ·ã€æ¢å¤ç»“æœ
- æä¾›æ¢å¤æ“ä½œçš„å®¡è®¡æ—¥å¿—

**æ™ºèƒ½æ¢å¤å»ºè®®ï¼š**
- åˆ†æå¤±è´¥ä»»åŠ¡çš„åŸå› 
- æä¾›æ¢å¤å»ºè®®å’Œæœ€ä½³å®è·µ
- è‡ªåŠ¨è¯†åˆ«å¯æ¢å¤çš„ä»»åŠ¡ç±»å‹

### æœ€ä½³å®è·µ

#### 1. æ¢å¤ç­–ç•¥
- **æ¸è¿›å¼æ¢å¤**: å…ˆæ¢å¤å°‘é‡ä»»åŠ¡æµ‹è¯•ç³»ç»Ÿç¨³å®šæ€§
- **ä¼˜å…ˆçº§æ¢å¤**: ä¼˜å…ˆæ¢å¤é‡è¦æ‘„åƒå¤´æˆ–å…³é”®æ—¶æ®µçš„ä»»åŠ¡
- **åˆ†æ‰¹æ¢å¤**: é¿å…ä¸€æ¬¡æ€§æ¢å¤å¤§é‡ä»»åŠ¡é€ æˆç³»ç»Ÿè´Ÿè½½è¿‡é«˜

#### 2. ç›‘æ§å’Œå‘Šè­¦
- ç›‘æ§ä»»åŠ¡æ¢å¤çš„æˆåŠŸç‡
- è®¾ç½®ä»»åŠ¡å¤±è´¥ç‡å‘Šè­¦é˜ˆå€¼
- è®°å½•æ¢å¤æ“ä½œçš„è¯¦ç»†æ—¥å¿—

#### 3. æ•°æ®å¤‡ä»½
- åœ¨å¤§è§„æ¨¡æ¢å¤æ“ä½œå‰å¤‡ä»½æ•°æ®åº“
- ä¿ç•™åŸå§‹ä»»åŠ¡æ•°æ®ä»¥ä¾¿å›æ»š
- å®šæœŸæ¸…ç†è¿‡æœŸçš„ä»»åŠ¡æ¢å¤è®°å½•

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥PostgreSQLæœåŠ¡çŠ¶æ€
docker ps | grep postgres

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker logs postgres

# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -h localhost -U rotanova -d easysight
```

#### 2. Redisè¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
docker ps | grep redis

# æµ‹è¯•Redisè¿æ¥
redis-cli ping
```

#### 3. MinIOè¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥MinIOæœåŠ¡çŠ¶æ€
docker ps | grep minio

# è®¿é—®MinIOæ§åˆ¶å°
http://localhost:9001
```

#### 4. WorkerèŠ‚ç‚¹è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping your-server-host
telnet your-server-host 8000

# æ£€æŸ¥è®¤è¯ä¿¡æ¯
curl -X POST http://your-server-host:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

## ğŸ¥ æµåª’ä½“æœåŠ¡ç«¯å£é…ç½®

### ç«¯å£æ¶æ„æ¦‚è§ˆ

EasySight æµåª’ä½“æœåŠ¡åŸºäº ZLMediaKit æ„å»ºï¼Œæä¾›å®Œæ•´çš„è§†é¢‘æµå¤„ç†å’Œåˆ†å‘èƒ½åŠ›ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„ç«¯å£é…ç½®è¯´æ˜ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EasySight ç«¯å£æ¶æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸»è¦æœåŠ¡ç«¯å£                                                â”‚
â”‚  â”œâ”€ EasySight ä¸»æœåŠ¡: 8000 (HTTP API)                      â”‚
â”‚  â”œâ”€ ZLMediaKit HTTP API: 8060                              â”‚
â”‚  â”œâ”€ ZLMediaKit ç®¡ç†ç•Œé¢: 18080                              â”‚
â”‚  â””â”€ å‰ç«¯åº”ç”¨: 3000 (å¼€å‘æ¨¡å¼)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æµåª’ä½“åè®®ç«¯å£                                              â”‚
â”‚  â”œâ”€ RTSP: 554                                              â”‚
â”‚  â”œâ”€ RTMP: 1935                                             â”‚
â”‚  â”œâ”€ HTTP-FLV: 8060                                         â”‚
â”‚  â”œâ”€ WebRTC: 8000 (UDP)                                     â”‚
â”‚  â”œâ”€ HLS: 8060                                              â”‚
â”‚  â””â”€ TS over WebSocket: 8060                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®åº“å’Œç¼“å­˜ç«¯å£                                            â”‚
â”‚  â”œâ”€ PostgreSQL: 5432                                       â”‚
â”‚  â”œâ”€ Redis: 6379                                            â”‚
â”‚  â”œâ”€ MinIO API: 9000                                        â”‚
â”‚  â”œâ”€ MinIO Console: 9001                                    â”‚
â”‚  â””â”€ RabbitMQ: 5672, 15672                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡æ¶æ„

#### 1. EasySight ä¸»æœåŠ¡ (ç«¯å£ 8000)
- **åŠŸèƒ½**: æä¾› REST API æ¥å£
- **åè®®**: HTTP/HTTPS
- **ç”¨é€”**: 
  - ç”¨æˆ·è®¤è¯å’Œæˆæƒ
  - æ‘„åƒå¤´ç®¡ç†
  - AI è¯Šæ–­ä»»åŠ¡è°ƒåº¦
  - ç³»ç»Ÿé…ç½®ç®¡ç†
  - WebSocket å®æ—¶é€šä¿¡

#### 2. ZLMediaKit æµåª’ä½“æœåŠ¡

**HTTP API ç«¯å£ (8060)**
- **åŠŸèƒ½**: æµåª’ä½“æ§åˆ¶å’Œç®¡ç† API
- **åè®®**: HTTP
- **ç”¨é€”**:
  - æµçŠ¶æ€æŸ¥è¯¢
  - æ¨æµ/æ‹‰æµæ§åˆ¶
  - å½•åˆ¶ç®¡ç†
  - ç»Ÿè®¡ä¿¡æ¯è·å–

**ç®¡ç†ç•Œé¢ç«¯å£ (18080)**
- **åŠŸèƒ½**: Web ç®¡ç†ç•Œé¢
- **åè®®**: HTTP
- **ç”¨é€”**:
  - æµåª’ä½“æœåŠ¡ç›‘æ§
  - é…ç½®ç®¡ç†
  - å®æ—¶ç»Ÿè®¡æŸ¥çœ‹

### è§†é¢‘æµå¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ‘„åƒå¤´     â”‚â”€â”€â”€â–ºâ”‚ ZLMediaKit  â”‚â”€â”€â”€â–ºâ”‚ EasySight   â”‚â”€â”€â”€â–ºâ”‚   å‰ç«¯      â”‚
â”‚  (RTSPæº)   â”‚    â”‚ æµåª’ä½“æœåŠ¡   â”‚    â”‚  ä¸»æœåŠ¡     â”‚    â”‚  æ’­æ”¾å™¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚                    â”‚                    â”‚
      â”‚                    â”‚                    â”‚                    â”‚
   RTSP://           HTTP-FLV/HLS         WebSocket           HTTP-FLV/
 camera-ip:554       :8060/live          :8000/ws            HLS/WebRTC
```

#### æµç¨‹è¯´æ˜ï¼š
1. **æ‘„åƒå¤´æ¨æµ**: æ‘„åƒå¤´é€šè¿‡ RTSP åè®®æ¨é€è§†é¢‘æµåˆ° ZLMediaKit
2. **åè®®è½¬æ¢**: ZLMediaKit å°† RTSP æµè½¬æ¢ä¸ºå¤šç§æ ¼å¼ï¼ˆHTTP-FLVã€HLSã€WebRTCï¼‰
3. **æµç®¡ç†**: EasySight ä¸»æœåŠ¡é€šè¿‡ HTTP API ç®¡ç†æµçŠ¶æ€
4. **å‰ç«¯æ’­æ”¾**: å‰ç«¯é€šè¿‡å¤šç§åè®®æ’­æ”¾è§†é¢‘æµ

### ç¯å¢ƒå˜é‡é…ç½®

#### ZLMediaKit é…ç½® (zlmediakitServer/.env)
```env
# HTTP API ç«¯å£
HTTP_PORT=8060

# RTSP ç«¯å£
RTSP_PORT=554

# RTMP ç«¯å£
RTMP_PORT=1935

# ç®¡ç†ç•Œé¢ç«¯å£
WEB_PORT=18080

# WebRTC ç«¯å£
WEBRTC_PORT=8000

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=INFO

# å½•åˆ¶é…ç½®
RECORD_ENABLE=true
RECORD_PATH=/data/record

# HLS é…ç½®
HLS_ENABLE=true
HLS_SEGMENT_DURATION=5
HLS_SEGMENT_NUM=3
```

#### EasySight ä¸»æœåŠ¡é…ç½® (backend/.env)
```env
# ZLMediaKit è¿æ¥é…ç½®
ZLMEDIAKIT_HOST=127.0.0.1
ZLMEDIAKIT_HTTP_PORT=8060
ZLMEDIAKIT_SECRET=035c73f7-bb6b-4889-a715-d9eb2d1925cc

# æµåª’ä½“é…ç½®
STREAM_TIMEOUT=30
STREAM_RETRY_COUNT=3
STREAM_BUFFER_SIZE=1024
```

### é˜²ç«å¢™é…ç½®å»ºè®®

#### Linux (iptables)
```bash
# å…è®¸ EasySight ä¸»æœåŠ¡
sudo iptables -A INPUT -p tcp --dport 8000 -j ACCEPT

# å…è®¸ ZLMediaKit HTTP API
sudo iptables -A INPUT -p tcp --dport 8060 -j ACCEPT

# å…è®¸ ZLMediaKit ç®¡ç†ç•Œé¢
sudo iptables -A INPUT -p tcp --dport 18080 -j ACCEPT

# å…è®¸ RTSP
sudo iptables -A INPUT -p tcp --dport 554 -j ACCEPT

# å…è®¸ RTMP
sudo iptables -A INPUT -p tcp --dport 1935 -j ACCEPT

# å…è®¸ WebRTC (UDP)
sudo iptables -A INPUT -p udp --dport 8000 -j ACCEPT

# ä¿å­˜è§„åˆ™
sudo iptables-save > /etc/iptables/rules.v4
```

#### Windows é˜²ç«å¢™
```powershell
# å…è®¸ EasySight ä¸»æœåŠ¡
New-NetFirewallRule -DisplayName "EasySight Main" -Direction Inbound -Protocol TCP -LocalPort 8000 -Action Allow

# å…è®¸ ZLMediaKit HTTP API
New-NetFirewallRule -DisplayName "ZLMediaKit HTTP" -Direction Inbound -Protocol TCP -LocalPort 8060 -Action Allow

# å…è®¸ ZLMediaKit ç®¡ç†ç•Œé¢
New-NetFirewallRule -DisplayName "ZLMediaKit Web" -Direction Inbound -Protocol TCP -LocalPort 18080 -Action Allow

# å…è®¸ RTSP
New-NetFirewallRule -DisplayName "RTSP" -Direction Inbound -Protocol TCP -LocalPort 554 -Action Allow

# å…è®¸ RTMP
New-NetFirewallRule -DisplayName "RTMP" -Direction Inbound -Protocol TCP -LocalPort 1935 -Action Allow

# å…è®¸ WebRTC
New-NetFirewallRule -DisplayName "WebRTC" -Direction Inbound -Protocol UDP -LocalPort 8000 -Action Allow
```

### å¥åº·æ£€æŸ¥

#### æœåŠ¡çŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥ EasySight ä¸»æœåŠ¡
curl -f http://localhost:8000/health || echo "EasySight ä¸»æœåŠ¡å¼‚å¸¸"

# æ£€æŸ¥ ZLMediaKit HTTP API
curl -f http://localhost:8060/index/api/getServerConfig || echo "ZLMediaKit API å¼‚å¸¸"

# æ£€æŸ¥ ZLMediaKit ç®¡ç†ç•Œé¢
curl -f http://localhost:18080 || echo "ZLMediaKit ç®¡ç†ç•Œé¢å¼‚å¸¸"

# æ£€æŸ¥ç«¯å£ç›‘å¬çŠ¶æ€
netstat -tlnp | grep -E ':(8000|8060|18080|554|1935)'
```

#### æµçŠ¶æ€æ£€æŸ¥
```bash
# è·å–æ‰€æœ‰æµä¿¡æ¯
curl "http://localhost:8060/index/api/getMediaList"

# è·å–ç‰¹å®šæµä¿¡æ¯
curl "http://localhost:8060/index/api/getMediaInfo?schema=rtsp&vhost=__defaultVhost__&app=live&stream=camera001"

# æ£€æŸ¥æµæ’­æ”¾ç»Ÿè®¡
curl "http://localhost:8060/index/api/getStatistic"
```

### æ•…éšœæ’æŸ¥

#### 1. ç«¯å£å†²çªé—®é¢˜
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :8000
lsof -i :8000

# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
ps aux | grep $(lsof -t -i:8000)

# ç»ˆæ­¢å ç”¨è¿›ç¨‹
kill -9 $(lsof -t -i:8000)
```

#### 2. æµåª’ä½“æœåŠ¡å¼‚å¸¸
```bash
# æŸ¥çœ‹ ZLMediaKit æ—¥å¿—
tail -f /var/log/zlmediakit/zlmediakit.log

# é‡å¯ ZLMediaKit æœåŠ¡
sudo systemctl restart zlmediakit

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /etc/zlmediakit/config.ini
```

#### 3. ç½‘ç»œè¿æ¥é—®é¢˜
```bash
# æµ‹è¯•ç«¯å£è¿é€šæ€§
telnet localhost 8060
nc -zv localhost 8060

# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status
sudo iptables -L

# æ£€æŸ¥ç½‘ç»œæ¥å£
ip addr show
ifconfig
```

#### 4. æ€§èƒ½é—®é¢˜
```bash
# ç›‘æ§ç³»ç»Ÿèµ„æº
top -p $(pgrep zlmediakit)
htop

# æ£€æŸ¥ç½‘ç»œæµé‡
iftop
netstat -i

# ç›‘æ§ç£ç›˜ I/O
iostat -x 1
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. ç³»ç»Ÿçº§ä¼˜åŒ–
```bash
# å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
echo "* soft nofile 65536" >> /etc/security/limits.conf
echo "* hard nofile 65536" >> /etc/security/limits.conf

# ä¼˜åŒ–ç½‘ç»œå‚æ•°
echo "net.core.rmem_max = 134217728" >> /etc/sysctl.conf
echo "net.core.wmem_max = 134217728" >> /etc/sysctl.conf
echo "net.ipv4.tcp_rmem = 4096 65536 134217728" >> /etc/sysctl.conf
echo "net.ipv4.tcp_wmem = 4096 65536 134217728" >> /etc/sysctl.conf
sysctl -p
```

#### 2. ZLMediaKit ä¼˜åŒ–
```ini
# config.ini ä¼˜åŒ–é…ç½®
[general]
# å¢åŠ çº¿ç¨‹æ•°
threadNum=0  # 0è¡¨ç¤ºè‡ªåŠ¨æ£€æµ‹CPUæ ¸å¿ƒæ•°

# ä¼˜åŒ–ç¼“å­˜
[protocol]
# å¢åŠ ç¼“å­˜æ—¶é—´
cacheMS=1000

# ä¼˜åŒ– HLS
[hls]
# å‡å°‘åˆ†ç‰‡æ—¶é—´æé«˜å®æ—¶æ€§
segDur=2
# å‡å°‘åˆ†ç‰‡æ•°é‡
segNum=3
```

### ç›‘æ§å’Œå‘Šè­¦

#### 1. æœåŠ¡ç›‘æ§è„šæœ¬
```bash
#!/bin/bash
# monitor_services.sh

check_service() {
    local service_name=$1
    local port=$2
    local url=$3
    
    if curl -f -s "$url" > /dev/null; then
        echo "[OK] $service_name (ç«¯å£ $port) è¿è¡Œæ­£å¸¸"
    else
        echo "[ERROR] $service_name (ç«¯å£ $port) å¼‚å¸¸" >&2
        # å‘é€å‘Šè­¦é€šçŸ¥
        # send_alert "$service_name æœåŠ¡å¼‚å¸¸"
    fi
}

# æ£€æŸ¥å„ä¸ªæœåŠ¡
check_service "EasySight ä¸»æœåŠ¡" 8000 "http://localhost:8000/health"
check_service "ZLMediaKit API" 8060 "http://localhost:8060/index/api/getServerConfig"
check_service "ZLMediaKit ç®¡ç†ç•Œé¢" 18080 "http://localhost:18080"
```

#### 2. æµçŠ¶æ€ç›‘æ§
```bash
#!/bin/bash
# monitor_streams.sh

# è·å–æµç»Ÿè®¡ä¿¡æ¯
stream_count=$(curl -s "http://localhost:8060/index/api/getMediaList" | jq '.data | length')
player_count=$(curl -s "http://localhost:8060/index/api/getStatistic" | jq '.data.PlayerCount')

echo "å½“å‰æµæ•°é‡: $stream_count"
echo "å½“å‰æ’­æ”¾å™¨æ•°é‡: $player_count"

# æ£€æŸ¥å¼‚å¸¸æµ
if [ "$stream_count" -eq 0 ]; then
    echo "[WARNING] æ²¡æœ‰æ´»è·ƒçš„è§†é¢‘æµ" >&2
fi

if [ "$player_count" -gt 100 ]; then
    echo "[WARNING] æ’­æ”¾å™¨æ•°é‡è¿‡å¤šï¼Œå¯èƒ½å½±å“æ€§èƒ½" >&2
fi
```

### æ€§èƒ½ä¼˜åŒ–

#### 1. æ•°æ®åº“ä¼˜åŒ–
- å®šæœŸæ‰§è¡ŒVACUUMå’ŒANALYZE
- åˆç†è®¾ç½®è¿æ¥æ± å¤§å°
- æ·»åŠ å¿…è¦çš„ç´¢å¼•
- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

#### 2. ç¼“å­˜ä¼˜åŒ–
- åˆç†è®¾ç½®Redisè¿‡æœŸæ—¶é—´
- ä½¿ç”¨Redisé›†ç¾¤æé«˜æ€§èƒ½
- ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡

#### 3. ç®—æ³•ä¼˜åŒ–
- åˆç†è®¾ç½®Workerå¹¶å‘æ•°
- ä¼˜åŒ–ç®—æ³•å¤„ç†æ—¶é—´
- ä½¿ç”¨GPUåŠ é€Ÿè®¡ç®—
- å®æ–½ç®—æ³•ç»“æœç¼“å­˜

## ğŸ” å®‰å…¨é…ç½®

### ç”Ÿäº§ç¯å¢ƒå®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - æ•°æ®åº“å¯†ç 
   - MinIOè®¿é—®å¯†é’¥
   - ç®¡ç†å‘˜è´¦æˆ·å¯†ç 
   - JWTå¯†é’¥

2. **ç½‘ç»œå®‰å…¨**
   - é…ç½®é˜²ç«å¢™è§„åˆ™
   - ä½¿ç”¨HTTPSåè®®
   - é™åˆ¶APIè®¿é—®æ¥æº
   - é…ç½®VPNè®¿é—®

3. **æ•°æ®å®‰å…¨**
   - å®šæœŸå¤‡ä»½æ•°æ®
   - åŠ å¯†æ•æ„Ÿæ•°æ®
   - é…ç½®è®¿é—®æ—¥å¿—
   - å®æ–½æ•°æ®ä¿ç•™ç­–ç•¥

4. **åº”ç”¨å®‰å…¨**
   - å®šæœŸæ›´æ–°ä¾èµ–åŒ…
   - é…ç½®CORSç­–ç•¥
   - å®æ–½APIé™æµ
   - ç›‘æ§å¼‚å¸¸è®¿é—®

## ğŸ“ˆ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„è¯Šæ–­ç®—æ³•

1. **åˆ›å»ºç®—æ³•ç±»**
```python
from diagnosis.algorithms import BaseAlgorithm

class CustomAlgorithm(BaseAlgorithm):
    def __init__(self, config):
        super().__init__(config)
        # åˆå§‹åŒ–ç®—æ³•
    
    def process(self, image_data):
        # å®ç°ç®—æ³•é€»è¾‘
        return {
            'score': 85,
            'status': 'NORMAL',
            'details': {}
        }
```

2. **æ³¨å†Œç®—æ³•**
```python
# åœ¨diagnosis/algorithms.pyä¸­æ³¨å†Œ
ALGORITHM_REGISTRY['CUSTOM'] = CustomAlgorithm
```

3. **æ·»åŠ æ•°æ®åº“æšä¸¾**
```python
# åœ¨models/diagnosis.pyä¸­æ·»åŠ 
class DiagnosisType(str, Enum):
    # ... ç°æœ‰ç±»å‹
    CUSTOM = "custom"
```

### æ·»åŠ æ–°çš„APIæ¥å£

1. **åˆ›å»ºè·¯ç”±æ–‡ä»¶**
```python
# routers/custom.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from database import get_db

router = APIRouter()

@router.get("/custom-endpoint")
async def custom_endpoint(db: Session = Depends(get_db)):
    return {"message": "Custom endpoint"}
```

2. **æ³¨å†Œè·¯ç”±**
```python
# main.py
from routers import custom
app.include_router(custom.router, prefix="/api/v1/custom", tags=["è‡ªå®šä¹‰"])
```

### æ·»åŠ æ–°çš„å‰ç«¯é¡µé¢

1. **åˆ›å»ºé¡µé¢ç»„ä»¶**
```vue
<!-- src/views/custom/CustomPage.vue -->
<template>
  <div class="custom-page">
    <h1>è‡ªå®šä¹‰é¡µé¢</h1>
  </div>
</template>

<script setup lang="ts">
// é¡µé¢é€»è¾‘
</script>
```

2. **æ·»åŠ è·¯ç”±**
```typescript
// src/router/index.ts
{
  path: '/custom',
  name: 'Custom',
  component: () => import('@/views/custom/CustomPage.vue')
}
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-01)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- å®Œæ•´çš„æ™ºèƒ½å®‰é˜²å¹³å°åŠŸèƒ½
- æ”¯æŒ14ç§è¯Šæ–­ç®—æ³•
- åˆ†å¸ƒå¼Workeræ¶æ„
- ç°ä»£åŒ–Webç•Œé¢

### ä¸»è¦æ›´æ–°è®°å½•
- **ç®—æ³•è¯„åˆ†æ ‡å‡†åŒ–**: ç»Ÿä¸€0-100åˆ†åˆ¶è¯„åˆ†ç³»ç»Ÿ
- **è“å±æ£€æµ‹ä¼˜åŒ–**: æ”¹è¿›è¯„åˆ†é€»è¾‘å’ŒçŠ¶æ€åˆ¤æ–­
- **Workeré‡è¿æœºåˆ¶**: ä¿®å¤ä¸»æœåŠ¡é‡å¯åçš„è¿æ¥é—®é¢˜
- **åŠ¨æ€ç®—æ³•åŠ è½½**: æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ç®—æ³•åŒ…
- **ä»»åŠ¡æ¢å¤æœºåˆ¶**: è‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤å¡ä½çš„è¯Šæ–­ä»»åŠ¡
- **é˜ˆå€¼é…ç½®å¢å¼º**: æ”¯æŒä»æ¨¡æ¿ä¼ é€’è‡ªå®šä¹‰é˜ˆå€¼å‚æ•°
- **æ—¥å¿—ç³»ç»Ÿä¼˜åŒ–**: æ”¹è¿›æ—¥å¿—è®°å½•å’Œæ—¶åŒºå¤„ç†

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘æµç¨‹
1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

### ä»£ç è§„èŒƒ
- **Python**: éµå¾ªPEP 8è§„èŒƒ
- **TypeScript**: ä½¿ç”¨ESLintå’ŒPrettier
- **Vue**: éµå¾ªVue 3 Composition APIè§„èŒƒ
- **æäº¤ä¿¡æ¯**: ä½¿ç”¨è¯­ä¹‰åŒ–æäº¤ä¿¡æ¯

### æµ‹è¯•è¦æ±‚
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- é›†æˆæµ‹è¯•é€šè¿‡
- æ€§èƒ½æµ‹è¯•è¾¾æ ‡
- å®‰å…¨æµ‹è¯•é€šè¿‡

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ è”ç³»æˆ‘ä»¬

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ä»¬ï¼š

- æäº¤ Issue
- å‘é€é‚®ä»¶
- åŠ å…¥è®¨è®ºç¾¤

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªæ˜Ÿæ ‡ï¼

**EasySight Team**  
*è®©æ™ºèƒ½å®‰é˜²æ›´ç®€å•*