# 蓝屏检测评分逻辑更新说明

## 更新概述

本次更新优化了蓝屏检测算法的评分逻辑，使评分结果更加直观和易于理解。

## 修改前的问题

### 原始评分逻辑
- **评分值**: 直接返回蓝色像素比例（0-1之间的小数）
- **问题**: 评分含义不直观，0.08分看起来像是低分，但实际表示正常状态
- **用户困惑**: 用户看到0.08分会误以为检测结果不好

### 示例
```python
# 修改前
blue_ratio = 0.08  # 8%的蓝色像素
return {'score': 0.08}  # 用户看到0.08分，误以为很低
```

## 修改后的改进

### 新的评分逻辑
- **评分范围**: 0-100分（标准化评分系统）
- **评分含义**: 分数越高越好，100分表示完全正常
- **分级标准**:
  - **100分**: 完全正常（无蓝色区域）
  - **60-100分**: 正常范围
  - **0-60分**: 异常范围

### 计算公式

```python
# 正常情况（蓝色比例 <= 阈值）
if blue_ratio <= threshold:
    score = 100 - (blue_ratio / threshold) * 40
    # 线性映射到60-100分

# 异常情况（蓝色比例 > 阈值）
else:
    excess_ratio = min(blue_ratio - threshold, threshold)
    score = 60 - (excess_ratio / threshold) * 60
    # 映射到0-60分
```

### 状态判断

1. **正常状态 (NORMAL)**: 蓝色比例 ≤ 40%（阈值的一半）
2. **警告状态 (WARNING)**: 40% < 蓝色比例 ≤ 80%（默认阈值）
3. **严重状态 (CRITICAL)**: 蓝色比例 > 80%

## 测试结果对比

### 测试场景

| 测试场景 | 蓝色比例 | 修改前评分 | 修改后评分 | 状态 | 说明 |
|---------|---------|-----------|-----------|------|------|
| 随机图像 | 16.5% | 0.165 | 91.7 | NORMAL | 正常画面 |
| 纯蓝色图像 | 100% | 1.000 | 45.0 | CRITICAL | 蓝屏检测 |
| 半蓝色图像 | 58.2% | 0.582 | 70.9 | WARNING | 警告级别 |
| 纯黑色图像 | 0% | 0.000 | 100.0 | NORMAL | 完美正常 |
| 纯白色图像 | 0% | 0.000 | 100.0 | NORMAL | 完美正常 |

### 评分优势

1. **直观性**: 100分制，用户一目了然
2. **一致性**: 与其他检测算法的评分体系保持一致
3. **可解释性**: 分数高低直接对应检测质量
4. **分级明确**: 三个状态级别，便于告警处理

## 配置参数

### 可调整的阈值

```python
# 在诊断任务配置中可以调整
config = {
    'thresholds': {
        'blue_screen_ratio': 0.8  # 蓝屏检测阈值（默认80%）
    }
}
```

### 建议配置

- **严格模式**: `blue_screen_ratio: 0.6` (60%)
- **标准模式**: `blue_screen_ratio: 0.8` (80%，默认)
- **宽松模式**: `blue_screen_ratio: 0.9` (90%)

## 兼容性说明

### 数据保留
- **原始数据**: 在`metrics.raw_score`中保留原始蓝色比例值
- **新评分**: 在`score`字段中返回标准化评分
- **向后兼容**: 现有API接口保持不变

### 数据结构

```python
{
    'status': 'normal',
    'score': 91.7,  # 新的标准化评分
    'threshold': 0.8,
    'message': '画面正常: 16.50% (评分: 91.7)',
    'metrics': {
        'blue_ratio': 0.165,  # 原始蓝色比例
        'blue_pixels': 50660,
        'raw_score': 0.165,  # 保留原始评分
        'normalized_score': 91.7  # 标准化评分
    }
}
```

## 使用建议

### 告警配置
- **正常**: 评分 ≥ 80分
- **注意**: 60-80分
- **告警**: 评分 < 60分

### 监控建议
- 关注评分趋势变化
- 结合蓝色比例进行详细分析
- 根据实际场景调整阈值

## 更新日期

**更新时间**: 2025年7月15日  
**版本**: v1.1  
**影响范围**: 蓝屏检测算法评分逻辑  
**兼容性**: 向后兼容，保留原始数据